Whatâ€™s Not Working
No network request reaches backend

No "Response status" log

Loading state is stuck indefinitely

No hasError, no hasData â€“ indicates fetch promise is neither resolving nor rejecting

ðŸ” Root Cause Possibilities & Fixes
ðŸ§± 1. Fetch Promise Is Hanging (Not Resolving)
Symptoms:

You see "QUERY FUNCTION EXECUTING" but nothing afterward

No error, no response

Likely Causes:

Missing await or incorrect async handling in your query function

fetch() not returning or being awaited properly

Internal .then() chain never resolving or rejecting

Fix:
Make sure your query function is fully async, and youâ€™re properly awaiting the fetch:

ts
Copy
Edit
const fetchAssessment = async ({ queryKey }) => {
  console.log("=== QUERY FUNCTION EXECUTING ===");
  const [_, id] = queryKey;

  const res = await fetch(`/api/assessment/${id}`, {
    headers: {
      Authorization: `Bearer ${token}`,
    },
  });

  console.log("Response status:", res.status);

  if (!res.ok) {
    throw new Error("Failed to fetch assessment");
  }

  return res.json();
};
âš ï¸ 2. React Query Not Refetching After Cache Bust
If you see "QUERY FUNCTION EXECUTING" once but not on retry, the cache might be returning a Promise that never resolves again.

Fixes:

Add a unique key per session/load or add refetchOnMount: true:

ts
Copy
Edit
useQuery(['assessment', id], fetchAssessment, {
  enabled: !!id,
  refetchOnMount: true,
  staleTime: 0,
});
Or explicitly refetch on page load:

ts
Copy
Edit
useEffect(() => {
  if (query.isIdle || query.isError) {
    query.refetch();
  }
}, []);
ðŸ”’ 3. CORS or Backend Hanging (Timeout)
The request might start but never complete due to:

Backend function stuck on DB call or logic

CORS misconfiguration causing silent failure

Fix:

Check if the route /api/assessment/:id has any asynchronous DB call that might not resolve (e.g., Prisma, Mongoose)

Add try/catch to backend and log start/finish of the endpoint:

ts
Copy
Edit
app.get('/api/assessment/:id', async (req, res) => {
  console.log("Request received for ID", req.params.id);
  try {
    const data = await getAssessmentFromDB(req.params.id);
    console.log("Sending response");
    res.json(data);
  } catch (err) {
    console.error("Error in assessment API", err);
    res.status(500).json({ error: "Internal server error" });
  }
});
ðŸ§  4. Client-Side Parsing Error / Silent Exception
If the response body is malformed (e.g., not JSON), .json() will throw and React Query will stay stuck unless caught.

Fix:
Wrap .json() call:

ts
Copy
Edit
let res;
try {
  res = await fetch(...);
} catch (e) {
  console.error("Fetch error", e);
  throw e;
}

try {
  const json = await res.json();
  return json;
} catch (e) {
  console.error("Failed to parse response JSON", e);
  throw new Error("Invalid response from server");
}
âœ… Final Debugging Checklist
Check	Action
âœ… fetch is awaited	Confirm await fetch() and await res.json()
âœ… API endpoint logs	Add logs at request start and before response
âœ… React Query is not stuck	Set refetchOnMount: true, disable cache temporarily
âœ… Server returns res.ok	Confirm backend is not silently failing
âœ… Add fallback UI	Show "Loading..." and timeout if stuck for > 10s

Optional: Add Timeout Safety
ts
Copy
Edit
const timeout = (ms) => new Promise((_, reject) => setTimeout(() => reject(new Error("Request timeout")), ms));

const fetchWithTimeout = async (url, options = {}) => {
  return Promise.race([
    fetch(url, options),
    timeout(10000),
  ]);
};
ðŸš€ What to Do Next
âœ… Confirm query function is async and all await calls are correct

âœ… Log response status, and body parsing

âœ… Temporarily disable cache or set staleTime: 0

âœ… Add logs to backend /api/assessment/:id route

âœ… Look at DevTools â†’ Network to verify if any request is sent

Would you like me to review your useQuery or query client setup for any silent blockers? Feel free to paste the function here.